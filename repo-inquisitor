#!/bin/bash

set -euo pipefail

# --- ARGUMENT PARSING ---

TARGET_DIR="${1:-.}"

if [ "$TARGET_DIR" == "--help" ]; then
	echo ""
	echo "Usage: repo-inquisitor [PATH]"
	echo ""
	echo "Arguments:"
	echo "  PATH          Path to the directory to analyze (default: current directory)"
	echo ""
	echo "Options:"
	echo "  --help        Show this help message"
	echo ""
	exit 0
fi

# --- VALIDATION ---

if [ ! -d "$TARGET_DIR" ]; then
	echo "‚ùå Error: Directory '$TARGET_DIR' does not exist."
	exit 1
fi

# --- MAIN LOGIC ---

FULL_PATH=$(cd "$TARGET_DIR" && pwd)

echo "üïµÔ∏è  Repo Inquisitor v0.1 " 
echo "üìÇ Analyzing directory: $FULL_PATH"

# --- CONFIGURATION (Colors) ---

RED='\033[0;31m'
YELLOW='\033[0;33m'
GREEN='\033[0;32m'
NC='\033[0m' # No Color

echo ""
echo "üîç Scanning for technical debt..."

# --- LOGIC: TODO COUNT ---

TODO_COUNT=$(grep -r "TODO" "$TARGET_DIR" --exclude-dir={.git,.build,Pods,DerivedData} | wc -l || true)
FIXME_COUNT=$(grep -r "FIXME" "$TARGET_DIR" --exclude-dir={.git,.build,Pods,DerivedData} | wc -l || true)

#--- REPORTING ---

echo -e "   Found ${YELLOW}${TODO_COUNT}${NC} TODOs"
echo -e "   Found ${RED}${FIXME_COUNT}${NC} FIXMEs"

# --- ANALYSIS / METRICS ---

if [ "$FIXME_COUNT" -gt 0 ]; then
	echo ""
	echo -e "${RED} ‚ö†Ô∏è    CRITICAL: You have unresolved FIXMEs! Fix them before release.${NC}"
else
	echo -e "${GREEN}‚úÖ Clean code! No FIXMEs found.${NC}"
fi

echo ""
echo "‚úÖ Analysis complete."
